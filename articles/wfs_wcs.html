<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example use cases to get data from web feature or web coverage services. • inbospatial</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example use cases to get data from web feature or web coverage services.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">inbospatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/spatial_dhmv_query.html">Dissecting a WCS Query: DHMV Case Study.</a></li>
    <li><a class="dropdown-item" href="../articles/wfs_wcs.html">Example use cases to get data from web feature or web coverage services.</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/inbo/inbospatial/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example use cases to get data from web feature or web coverage services.</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inbo/inbospatial/blob/main/vignettes/wfs_wcs.Rmd" class="external-link"><code>vignettes/wfs_wcs.Rmd</code></a></small>
      <div class="d-none name"><code>wfs_wcs.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/inbo/inbospatial" class="external-link">inbospatial</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A WFS or Web Feature Service allows you to download vector spatial
data from the web. A WCS or Web Coverage Service is similar, but is used
for raster spatial data. In this vignette, we will show how to the
functions <code><a href="../reference/get_feature_wfs.html">get_feature_wfs()</a></code> and
<code><a href="../reference/get_coverage_wcs.html">get_coverage_wcs()</a></code> can be used to get data into your R
session from these services.</p>
<p>For a more in-depth explanation about WFS services, we refer to <a href="https://tutorials.inbo.be/tutorials/spatial_wfs_services/" target="_BLANK" class="external-link">the INBO tutorial about WFS</a>. The tutorial takes a
more hands-on coding approach to getting data from a WFS, whereas in
this vignette much of the coding stuff is hidden away in the
<code><a href="../reference/get_feature_wfs.html">get_feature_wfs()</a></code> function.</p>
</div>
<div class="section level2">
<h2 id="wfs-examples">WFS examples<a class="anchor" aria-label="anchor" href="#wfs-examples"></a>
</h2>
<div class="section level3">
<h3 id="simple-use-case-without-filter">Simple use case without filter<a class="anchor" aria-label="anchor" href="#simple-use-case-without-filter"></a>
</h3>
<p>As a test case, we will query municipal boundaries of Flanders from
the “Provisional Reference Municipal Boundaries” (<code>VRBG</code>,
<code>Voorlopig ReferentieBestand Gemeentegrenzen</code>), which is
available via an API on the <code>vlaanderen.be</code> website.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wfs_vrbg</span> <span class="op">&lt;-</span> <span class="st">"https://geo.api.vlaanderen.be/VRBG/wfs"</span></span>
<span></span>
<span><span class="va">provinces</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_wfs.html">get_feature_wfs</a></span><span class="op">(</span></span>
<span>  wfs <span class="op">=</span> <span class="va">wfs_vrbg</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"VRBG:Refprv"</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:31370"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">provinces</span></span>
<span><span class="co">#&gt; Simple feature collection with 5 features and 7 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTISURFACE</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 21991.63 ymin: 153058.3 xmax: 258871.8 ymax: 244027.2</span></span>
<span><span class="co">#&gt; Projected CRS: BD72 / Belgian Lambert 72</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt;   gml_id    UIDN  OIDN TERRID NAAM       NISCODE NUTS2                     SHAPE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;MULTISURFACE [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Refprv.1    18     2    357 Antwerpen  10000   BE21  (POLYGON ((178136.3 2440…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Refprv.2    19     4    359 Vlaams Br… 20001   BE24  (POLYGON ((200484.9 1935…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Refprv.3    20     3    351 West-Vlaa… 30000   BE25  (POLYGON ((80681.53 2276…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Refprv.4    21     1    355 Limburg    70000   BE22  (POLYGON ((231494.3 2191…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Refprv.5    22     5    356 Oost-Vlaa… 40000   BE23  (POLYGON ((145735.2 2203…</span></span></code></pre></div>
<p>You can achieve (almost) the same result using a combination of
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::read_sf()</a></code> and <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">provinces2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"WFS:"</span>, <span class="va">wfs_vrbg</span><span class="op">)</span>,</span>
<span>  layer <span class="op">=</span> <span class="st">"VRBG:Refprv"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">waldo</span><span class="fu">::</span><span class="fu"><a href="https://waldo.r-lib.org/reference/compare.html" class="external-link">compare</a></span><span class="op">(</span><span class="va">provinces</span>, <span class="va">provinces2</span>,</span>
<span>  x_arg <span class="op">=</span> <span class="st">"inbospatial"</span>, y_arg <span class="op">=</span> <span class="st">"sf"</span>,</span>
<span>  max_diffs <span class="op">=</span> <span class="fl">8</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No differences</span></span></code></pre></div>
<p>Both methods yield the same result. Note however that for other
examples, you may notice substantial differences, most notably for field
specifications. The reason for such differences is that
<code><a href="../reference/get_feature_wfs.html">get_feature_wfs()</a></code> retrieves whatever information that is
identified from the WFS request - in the same way as you would paste the
request in the browser. This result is then saved temporarily to a
<code>.GML</code> file and read with <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::read_sf()</a></code>. Passing
the WFS directly to the <code>dsn</code> argument of
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::read_sf</a></code>, on the other hand, will translate the request
to a form that will pass through <a href="https://gdal.org/en/latest/drivers/vector/wfs.html" class="external-link">the GDAL WFS
driver</a>, which handles field specifications by reading them from a
<code>DescribeFeatureType</code> request:</p>
<blockquote>
<p>At the first opening, the content of the result of the
<code>GetCapabilities</code> request will be appended to the file, so
that it can be cached for later openings of the dataset. The same
applies for the <code>DescribeFeatureType</code> request issued to
discover the field definition of each layer.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="apply-a-cql-filter-to-filter-on-a-field">Apply a CQL-Filter to filter on a field<a class="anchor" aria-label="anchor" href="#apply-a-cql-filter-to-filter-on-a-field"></a>
</h3>
<p>CQL, the “Common Query Language” (<a href="https://docs.geoserver.org/stable/en/user/tutorials/cql/cql_tutorial.html" class="external-link">see
here, for example</a>), provides a way to filter WFS data. The syntax of
<a href="https://www.webcomand.com/docs/language/cql/cql_vs_sql/" class="external-link">CQL is
comparable to SQL</a>, yet there are differences in data types and
structures.</p>
<p>You can provide and apply filters in <code><a href="../reference/get_feature_wfs.html">get_feature_wfs()</a></code>
via the <code>cql_filter</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wfs_vrbg</span> <span class="op">&lt;-</span> <span class="st">"https://geo.api.vlaanderen.be/VRBG/wfs"</span></span>
<span></span>
<span><span class="va">prov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_wfs.html">get_feature_wfs</a></span><span class="op">(</span></span>
<span>  wfs <span class="op">=</span> <span class="va">wfs_vrbg</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"VRBG:Refprv"</span>,</span>
<span>  cql_filter <span class="op">=</span> <span class="st">"NAAM='West-Vlaanderen'"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">prov</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 7 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTISURFACE</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 21991.63 ymin: 155928.6 xmax: 90410.78 ymax: 229724.6</span></span>
<span><span class="co">#&gt; Projected CRS: BD72 / Belgian Lambert 72</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 8</span></span></span>
<span><span class="co">#&gt;   gml_id    UIDN  OIDN TERRID NAAM       NISCODE NUTS2                     SHAPE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;MULTISURFACE [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Refprv.3    20     3    351 West-Vlaa… 30000   BE25  (POLYGON ((80681.53 2276…</span></span></code></pre></div>
<p>Here, we could have also used <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::read_sf()</a></code> in
combination with an <a href="https://gdal.org/en/latest/user/ogr_sql_dialect.html" class="external-link">OGR SQL
query</a>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prov2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"WFS:"</span>, <span class="va">wfs_vrbg</span><span class="op">)</span>,</span>
<span>  query <span class="op">=</span> <span class="st">"SELECT * FROM Refprv WHERE NAAM='West-Vlaanderen'"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">waldo</span><span class="fu">::</span><span class="fu"><a href="https://waldo.r-lib.org/reference/compare.html" class="external-link">compare</a></span><span class="op">(</span><span class="va">prov</span>, <span class="va">prov2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No differences</span></span></code></pre></div>
<p>Both methods yield the same result.</p>
</div>
<div class="section level3">
<h3 id="request-a-subset-of-fields">Request a subset of fields<a class="anchor" aria-label="anchor" href="#request-a-subset-of-fields"></a>
</h3>
<p>Instead of querying the complete data table, one can select a subset
of variables (fields). The function <code><a href="../reference/get_feature_wfs.html">get_feature_wfs()</a></code>
provides the <code>property_name</code> keyword for it, which accepts a
string of comma-separated field names. Note that field names are
capitalized on this particular geoserver.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wfs_vrbg</span> <span class="op">&lt;-</span> <span class="st">"https://geo.api.vlaanderen.be/VRBG/wfs"</span></span>
<span></span>
<span><span class="va">prov_fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_wfs.html">get_feature_wfs</a></span><span class="op">(</span></span>
<span>  wfs <span class="op">=</span> <span class="va">wfs_vrbg</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"VRBG:Refprv"</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:31370"</span>,</span>
<span>  property_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"NAAM"</span>, <span class="st">"NUTS2"</span>, <span class="st">"SHAPE"</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">prov_fields</span></span>
<span><span class="co">#&gt; Simple feature collection with 5 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTISURFACE</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 21991.63 ymin: 153058.3 xmax: 258871.8 ymax: 244027.2</span></span>
<span><span class="co">#&gt; Projected CRS: BD72 / Belgian Lambert 72</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 3</span></span></span>
<span><span class="co">#&gt;   NAAM            NUTS2                                                    SHAPE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                       <span style="color: #949494; font-style: italic;">&lt;MULTISURFACE [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Antwerpen       BE21  (POLYGON ((178136.3 244009.2, 178131.2 244010.4, 178133…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Vlaams Brabant  BE24  (POLYGON ((200484.9 193541, 200484.8 193541.2, 200484.5…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> West-Vlaanderen BE25  (POLYGON ((80681.53 227626.5, 80777.99 228143, 80661.88…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Limburg         BE22  (POLYGON ((231494.3 219142.5, 231194.3 219455.2, 230929…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Oost-Vlaanderen BE23  (POLYGON ((145735.2 220358.3, 145217.2 220640.1, 145216…</span></span></code></pre></div>
<p>Again, we can use <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::read_sf()</a></code> in combination with an
<a href="https://gdal.org/en/latest/user/ogr_sql_dialect.html" class="external-link">OGR SQL
query</a>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prov_fields_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"WFS:"</span>, <span class="va">wfs_vrbg</span><span class="op">)</span>,</span>
<span>  query <span class="op">=</span> <span class="st">"SELECT NAAM, NUTS2 FROM Refprv"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">waldo</span><span class="fu">::</span><span class="fu"><a href="https://waldo.r-lib.org/reference/compare.html" class="external-link">compare</a></span><span class="op">(</span><span class="va">prov_fields</span>, <span class="va">prov_fields_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No differences</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="meteorological-data-example">Meteorological data example<a class="anchor" aria-label="anchor" href="#meteorological-data-example"></a>
</h3>
<p>Another example of a WFS API is the Belgian Royal Meteorological
Institute (KMI,
<code>Koninklijk Meteorologisch Instituut van België</code>). Details
can be <a href="https://opendata.meteo.be/service/wfs?request=GetCapabilities" class="external-link">found
here</a>, <a href="https://publish.geo.be/geonetwork/f0ow2say/api/records/RMI_AWS_WFS" class="external-link">and
here</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmi</span> <span class="op">&lt;-</span> <span class="st">"https://opendata.meteo.be/service/wfs"</span></span>
<span></span>
<span><span class="va">kmi_stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_wfs.html">get_feature_wfs</a></span><span class="op">(</span></span>
<span>  wfs <span class="op">=</span> <span class="va">kmi</span>,</span>
<span>  layer <span class="op">=</span> <span class="st">"synop:synop_station"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">kmi_stations</span></span>
<span><span class="co">#&gt; Simple feature collection with 22 features and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 2.887306 ymin: 49.62036 xmax: 6.073438 ymax: 51.34738</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 5</span></span></span>
<span><span class="co">#&gt;    gml_id           name  altitude date_end                       the_geom</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> synop_station.6… SPA …    482   <span style="color: #BB0000;">NA</span>                  (5.909864 50.47861)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> synop_station.6… SAIN…    557   <span style="color: #BB0000;">NA</span>                  (5.403753 50.03887)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> synop_station.6… BEIT…     24.8 <span style="color: #BB0000;">NA</span>                  (3.121692 50.90398)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> synop_station.6… ZEEB…     12.1 <span style="color: #BB0000;">NA</span>                  (3.201846 51.34737)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> synop_station.6… STAB…      4   <span style="color: #BB0000;">NA</span>                   (4.363798 51.3248)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> synop_station.6… UCCL…    101.  2003-12-09 <span style="color: #949494;">08:00:00</span> (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> synop_station.6… UCCL…    101.  <span style="color: #BB0000;">NA</span>                  (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> synop_station.6… DIEP…     39.3 <span style="color: #BB0000;">NA</span>                  (5.450296 50.91546)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> synop_station.6… BIER…    178   <span style="color: #BB0000;">NA</span>                  (5.458738 50.64528)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> synop_station.6… SINT…      8.3 <span style="color: #BB0000;">NA</span>                  (4.524608 51.07512)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span></code></pre></div>
<p>This is a list of all KMI stations. You can plot it with
<code>leaflet</code> or <code>mapview</code> to see the stations on a
map and learn that -for instance- Ukkel has code 6447. So let’s extract
the maximum daily temperatures for Ukkel starting from the year
2000.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmi_synop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_wfs.html">get_feature_wfs</a></span><span class="op">(</span></span>
<span>  wfs <span class="op">=</span> <span class="va">kmi</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"synop:synop_data"</span>,</span>
<span>  property_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"code"</span>, <span class="st">"timestamp"</span>, <span class="st">"temp_max"</span>, <span class="st">"the_geom"</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">","</span></span>
<span>  <span class="op">)</span>,</span>
<span>  cql_filter <span class="op">=</span> <span class="st">"((code = 6447) AND (temp_max IS NOT NULL) AND</span></span>
<span><span class="st">    (timestamp &gt;= '2000-01-01 00:00:00.000'))"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">kmi_synop</span></span>
<span><span class="co">#&gt; Simple feature collection with 9074 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4.357871 ymin: 50.79666 xmax: 4.357875 ymax: 50.79686</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9,074 × 4</span></span></span>
<span><span class="co">#&gt;     code timestamp           temp_max            the_geom</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">6</span>447 2021-08-06 <span style="color: #949494;">18:00:00</span>     20.6 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">6</span>447 2021-09-17 <span style="color: #949494;">18:00:00</span>     22.2 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">6</span>447 2021-09-16 <span style="color: #949494;">18:00:00</span>     20.9 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">6</span>447 2021-09-18 <span style="color: #949494;">18:00:00</span>     23   (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">6</span>447 2021-09-19 <span style="color: #949494;">18:00:00</span>     21.7 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">6</span>447 2021-09-20 <span style="color: #949494;">18:00:00</span>     19   (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">6</span>447 2021-09-21 <span style="color: #949494;">18:00:00</span>     18.3 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">6</span>447 2021-09-22 <span style="color: #949494;">18:00:00</span>     19.8 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">6</span>447 2021-08-07 <span style="color: #949494;">18:00:00</span>     20.6 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">6</span>447 2021-08-08 <span style="color: #949494;">18:00:00</span>     20.1 (4.357871 50.79686)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9,064 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-filtering-using-a-bounding-box">Spatial filtering using a bounding box<a class="anchor" aria-label="anchor" href="#spatial-filtering-using-a-bounding-box"></a>
</h3>
<p>Few analyses will require a whole countries’ data, even if the
country is as small as Belgium. Hence, it might be useful by restricting
the data you query with a bounding box. This works as follows, using a
<code>bbox</code> with the elements <code>xmin</code>,
<code>ymin</code>, <code>xmax</code>, and <code>ymax</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wfs_bwk</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://geo.api.vlaanderen.be/BWK/wfs"</span></span>
<span></span>
<span><span class="va">bwk_bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_wfs.html">get_feature_wfs</a></span><span class="op">(</span></span>
<span>  wfs <span class="op">=</span> <span class="va">wfs_bwk</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"BWK:Bwkhab"</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:31370"</span>,</span>
<span>  bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">142600</span>, ymin <span class="op">=</span> <span class="fl">153800</span>, xmax <span class="op">=</span> <span class="fl">146000</span>, ymax <span class="op">=</span> <span class="fl">156900</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bwk_bbox</span></span>
<span><span class="co">#&gt; Simple feature collection with 668 features and 32 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTISURFACE</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 137307.1 ymin: 153734.4 xmax: 146672.9 ymax: 160747.2</span></span>
<span><span class="co">#&gt; Projected CRS: BD72 / Belgian Lambert 72</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 668 × 33</span></span></span>
<span><span class="co">#&gt;    gml_id      UIDN   OIDN TAG   EVAL  EENH1 EENH2 EENH3 EENH4 EENH5 EENH6 EENH7</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Bwkhab.6… 1.33<span style="color: #949494;">e</span>6 7.69<span style="color: #949494;">e</span>5 3785… z     va    qe    vc    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Bwkhab.6… 7.29<span style="color: #949494;">e</span>5 7.06<span style="color: #949494;">e</span>5 5330… w     ni    que   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Bwkhab.7… 1.37<span style="color: #949494;">e</span>6 8.15<span style="color: #949494;">e</span>5 2468… m     ur    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Bwkhab.9… 1.59<span style="color: #949494;">e</span>6 1.01<span style="color: #949494;">e</span>6 4050… wz    hr    hc-   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Bwkhab.6… 1.32<span style="color: #949494;">e</span>6 7.57<span style="color: #949494;">e</span>5 4075… m     ua    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Bwkhab.7… 7.35<span style="color: #949494;">e</span>5 7.12<span style="color: #949494;">e</span>5 5393… z     fe    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Bwkhab.7… 1.38<span style="color: #949494;">e</span>6 8.19<span style="color: #949494;">e</span>5 3947… z     cg    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Bwkhab.9… 7.57<span style="color: #949494;">e</span>5 7.35<span style="color: #949494;">e</span>5 5779… w     pmp   lar   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Bwkhab.8… 1.53<span style="color: #949494;">e</span>6 9.52<span style="color: #949494;">e</span>5 3975… mwz   hp    n     kh    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Bwkhab.7… 7.35<span style="color: #949494;">e</span>5 7.13<span style="color: #949494;">e</span>5 5394… w     pmb   lar   cas   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 658 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more variables: EENH8 &lt;chr&gt;, V1 &lt;chr&gt;, V2 &lt;chr&gt;, V3 &lt;chr&gt;, HERK &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   INFO &lt;chr&gt;, BWKLABEL &lt;chr&gt;, HAB1 &lt;chr&gt;, PHAB1 &lt;int&gt;, HAB2 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PHAB2 &lt;int&gt;, HAB3 &lt;chr&gt;, PHAB3 &lt;int&gt;, HAB4 &lt;chr&gt;, PHAB4 &lt;int&gt;, HAB5 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PHAB5 &lt;int&gt;, HERKHAB &lt;chr&gt;, HERKPHAB &lt;chr&gt;, HABLEGENDE &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   SHAPE &lt;MULTISURFACE [m]&gt;</span></span></span></code></pre></div>
<p>This returns a <code>MULTISURFACE</code> geometry type. We can use a
couple of <code>sf</code> functions to cast this to regular
polygons:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bwk_bbox</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"GEOMETRYCOLLECTION"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_collection_extract.html" class="external-link">st_collection_extract</a></span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="wfs_wcs_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>This can also be done using the <code>wkt_filter</code> argument from
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::read_sf</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bwk_bbox_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"WFS:"</span>, <span class="va">wfs_bwk</span><span class="op">)</span>,</span>
<span>  layer <span class="op">=</span> <span class="st">"BWK:Bwkhab"</span>,</span>
<span>  wkt_filter <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_text.html" class="external-link">st_as_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">142600</span>, ymin <span class="op">=</span> <span class="fl">153800</span>, xmax <span class="op">=</span> <span class="fl">146000</span>, ymax <span class="op">=</span> <span class="fl">156900</span><span class="op">)</span>,</span>
<span>        crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">31370</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-filters-using-spatial-binary-predicates">Spatial filters using spatial binary predicates<a class="anchor" aria-label="anchor" href="#spatial-filters-using-spatial-binary-predicates"></a>
</h3>
<p>In addition to the filters above, you can use logical operations to
restrict your area of interest. For example, features can be selected by
intersection with another geographical object.</p>
<div class="section level4">
<h4 id="intersects-a-point">Intersects a point<a class="anchor" aria-label="anchor" href="#intersects-a-point"></a>
</h4>
<p>As a proof of concept, we can directly query soil parameters at a
specific location.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wfs_soiltypes</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://www.dov.vlaanderen.be/geoserver/bodemkaart/bodemtypes/wfs"</span></span>
<span></span>
<span><span class="va">x_lam</span> <span class="op">&lt;-</span> <span class="fl">173995</span></span>
<span><span class="va">y_lam</span> <span class="op">&lt;-</span> <span class="fl">212093</span></span>
<span></span>
<span><span class="va">soil_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_feature_wfs.html">get_feature_wfs</a></span><span class="op">(</span></span>
<span>  wfs <span class="op">=</span> <span class="va">wfs_soiltypes</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"bodemkaart:bodemtypes"</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:31370"</span>,</span>
<span>  cql_filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>    <span class="st">"INTERSECTS(geom,POINT(%s %s))"</span>,</span>
<span>    <span class="va">x_lam</span>, <span class="va">y_lam</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_type</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 45 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTISURFACE</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 173846.5 ymin: 211962.5 xmax: 174030.9 ymax: 212190</span></span>
<span><span class="co">#&gt; Projected CRS: BD72 / Belgian Lambert 72</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 46</span></span></span>
<span><span class="co">#&gt;   gml_id             gid id_kaartvlak Bodemtype Unibodemtype Bodemserie</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bodemtypes.72727 <span style="text-decoration: underline;">67</span>754        <span style="text-decoration: underline;">67</span>754 s-Pgp3(v) s-Pgp3(v)    Pgp       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more variables: Beknopte_omschrijving_bodemserie &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Substraat_legende &lt;chr&gt;, Gegeneraliseerde_legende &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Substraat_code &lt;chr&gt;, Substraat_Vlaanderen &lt;chr&gt;, Textuurklasse_code &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Textuurklasse &lt;chr&gt;, Drainageklasse_code &lt;chr&gt;, Drainageklasse &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Profielontwikkelingsgroep_code &lt;chr&gt;, Profielontwikkelingsgroep &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Fase_code &lt;chr&gt;, Fase &lt;chr&gt;, Variante_van_het_moedermateriaal_code &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Variante_van_het_moedermateriaal &lt;chr&gt;, …</span></span></span></code></pre></div>
<p>In theory, this should also be possible “the <code>sf</code> way”.
However, <code>sf</code> filters after query (which takes a long time),
and the code below does not work correctly.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soil_type_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"WFS:"</span>, <span class="va">wfs_soiltypes</span><span class="op">)</span>,</span>
<span>  query <span class="op">=</span> <span class="st">"SELECT * FROM bodemtypes"</span>,</span>
<span>  wkt_filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>    <span class="st">"ST_Intersects(geom,ST_Point(%s, %s))"</span>,</span>
<span>    <span class="va">x_lam</span>, <span class="va">y_lam</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_type_sf</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="wcs-examples">WCS examples<a class="anchor" aria-label="anchor" href="#wcs-examples"></a>
</h2>
<p>Above, we covered Web Feature Services (WFS), which are many kinds of
vector data. Another common geographical data type are grid-like or
“raster” data, which you can retrieve via <em>Web Coverage Services
(WCS)</em>. Behold, there is a <code><a href="../reference/get_coverage_wcs.html">get_coverage_wcs()</a></code> available
for some of the web services we regularly use at INBO.</p>
<p>Below the example of a false-colour infrared image. The three bands
of the image are visualized using <code><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">terra::plotRGB</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">99477</span>, xmax <span class="op">=</span> <span class="fl">99541</span>, ymin <span class="op">=</span> <span class="fl">172580</span>, ymax <span class="op">=</span> <span class="fl">172640</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">31370</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">omz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_coverage_wcs.html">get_coverage_wcs</a></span><span class="op">(</span></span>
<span>  wcs <span class="op">=</span> <span class="st">"omz"</span>,</span>
<span>  bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"OI.OrthoimageCoverage.OMZ.CIR"</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"1.0.0"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">omz</span><span class="op">)</span></span></code></pre></div>
<p><img src="wfs_wcs_files/figure-html/omz-example-1.png" width="700"></p>
<p>Another example, this time extracting the digital terrain model for
the same bounding box:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_coverage_wcs.html">get_coverage_wcs</a></span><span class="op">(</span></span>
<span>  wcs <span class="op">=</span> <span class="st">"dtm"</span>,</span>
<span>  bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>  layername <span class="op">=</span> <span class="st">"EL.GridCoverage.DTM"</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">)</span></span></code></pre></div>
<p><img src="wfs_wcs_files/figure-html/dtm-example-1.png" width="700"></p>
<p>More details on WCS can be found in the
<code>spatial_dhmv_query.Rmd</code> vignette.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/hansvancalster" class="external-link">Hans Van Calster</a>, <a href="https://www.vlaanderen.be/inbo/en-gb" class="external-link"><img src="https://inbo.github.io/checklist/reference/figures/logo-en.png" height="24" alt="logo of the Research Institute for Nature and Forest (INBO)"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
